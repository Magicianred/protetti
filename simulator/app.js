import{BALL_RADIUS,CANVAS_SIZE,DESKTOP_CANVAS_SIZE,STARTING_BALLS,RUN,STATIC_PEOPLE_PERCENTATGE,STATES,SPEED_FROM_UI_MULTIPLIER}from"./options.js";import{replayButton,deathFilter,stayHomeFilter}from"./dom.js";import{Ball}from"./Ball.js";import{resetValues,updateCount}from"./results.js";let balls=[];const matchMedia=window.matchMedia("(min-width: 800px)");let isDesktop=matchMedia.matches;export const canvas=new window.p5(e=>{const t=()=>{let t=0;const a=document.getElementById("app_users");STARTING_BALLS[STATES.infected]=document.getElementById("infected_people").value;const s=document.getElementById("max_movement_speed").value*SPEED_FROM_UI_MULTIPLIER,o=document.getElementById("total_people").value;STARTING_BALLS[STATES.well]=o-STARTING_BALLS[STATES.infected],balls=[],Object.keys(STARTING_BALLS).forEach(o=>{Array.from({length:STARTING_BALLS[o]},()=>{const l=!RUN.filters.stayHome||(e.random(0,100)<STATIC_PEOPLE_PERCENTATGE||o===STATES.infected);balls[t]=new Ball({id:t,sketch:e,state:o,hasMovement:l,x:e.random(BALL_RADIUS,e.width-BALL_RADIUS),y:e.random(BALL_RADIUS,e.height-BALL_RADIUS),has_app_installed:100*Math.random()<a.value,maxMovementSpeed:s}),t++})})},a=()=>{const{height:t,width:a}=isDesktop?DESKTOP_CANVAS_SIZE:CANVAS_SIZE;e.createCanvas(a,t)};var s=!1;e.setup=()=>{a(),matchMedia.addListener(e=>{isDesktop=e.matches,a(),t(),resetValues()}),replayButton.onclick=()=>{s=!0,t(),resetValues()},deathFilter.onclick=()=>{RUN.filters.death=!RUN.filters.death,document.getElementById("death-count").classList.toggle("show",RUN.filters.death),t(),resetValues()},stayHomeFilter.onchange=()=>{RUN.filters.stayHome=!RUN.filters.stayHome,t(),resetValues()}},e.draw=()=>{e.background("white"),balls.forEach(e=>{e.checkState(),e.checkCollisions({others:balls}),e.move(),e.render()}),s&&updateCount()}},document.getElementById("canvas"));
